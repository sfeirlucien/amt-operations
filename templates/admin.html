{% extends "base.html" %}
{% block content %}
<h3 class="fw-bold mb-4">Management Console</h3>
<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card p-3 border-0 shadow-sm mb-4">
            <h6 class="fw-bold text-primary">Register Vessel</h6>
            <form method="POST">
                <input type="hidden" name="form_action" value="add_vessel">
                <input name="name" class="form-control mb-2" placeholder="Vessel Name" required>
                <input name="imo" class="form-control mb-2" placeholder="IMO Number" required>
                <input name="flag" class="form-control mb-2" placeholder="Flag">
                <input name="class_society" class="form-control mb-3" placeholder="Class (e.g. DNV)">
                <button class="btn btn-primary w-100 btn-sm">Add Vessel</button>
            </form>
        </div>
        <div class="card p-3 border-0 shadow-sm">
            <h6 class="fw-bold">User Access</h6>
            <form method="POST">
                <input type="hidden" name="form_action" value="add_user">
                <input name="new_user" class="form-control mb-2" placeholder="Username" required>
                <input name="new_pass" class="form-control mb-2" placeholder="Password" required>
                <select name="new_role" class="form-select mb-3"><option value="viewer">Viewer</option><option value="admin">Admin</option></select>
                <button class="btn btn-dark w-100 btn-sm">Create User</button>
            </form>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card p-3 border-0 shadow-sm mb-4 bg-dark text-white">
            <h6 class="fw-bold text-info">Audit History</h6>
            <div class="small" style="max-height: 150px; overflow-y: auto;">
                {% for l in logs %}<div class="border-bottom border-secondary py-1 text-muted">[{{ l.timestamp.strftime('%H:%M') }}] {{ l.user }}: {{ l.action }}</div>{% endfor %}
            </div>
        </div>
        <div class="card p-3 border-0 shadow-sm">
            <h6 class="fw-bold text-success">Add Certificate / Survey</h6>
            <form method="POST" enctype="multipart/form-data" class="row g-2">
                <input type="hidden" name="form_action" value="add_cert">
                <div class="col-md-6"><select name="vessel_id" class="form-select">{% for v in vessels %}<option value="{{v.id}}">{{v.name}}</option>{% endfor %}</select></div>
                <div class="col-md-6"><input name="cert_name" class="form-control" placeholder="Cert Name" required></div>
                <div class="col-md-6"><select name="category" class="form-select"><option>Statutory</option><option>Class Survey</option><option>Safety Equipment</option></select></div>
                <div class="col-md-6"><input type="date" name="expiry" class="form-control" required></div>
                <div class="col-md-12"><input type="file" name="file" class="form-control"></div>
                <div class="col-12"><button class="btn btn-success w-100 btn-sm">Save Record</button></div>
            </form>
        </div>
        <div class="card p-3 border-0 shadow-sm mt-4 bg-light">
            <h6 class="fw-bold text-danger">Backup & Restore</h6>
            <div class="d-flex gap-2">
                <a href="/backup" class="btn btn-outline-dark btn-sm w-50">Download Backup</a>
                <form method="POST" enctype="multipart/form-data" class="w-50 d-flex">
                    <input type="hidden" name="form_action" value="restore_db">
                    <input type="file" name="backup_file" class="form-control form-control-sm me-1" required>
                    <button class="btn btn-danger btn-sm">Restore</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
